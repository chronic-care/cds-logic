{
  "resourceType": "Library",
  "id": "library-cds-reporting",
  "url": "http://github.com/chronic-care/fhir/Library/library-cds-reporting",
  "version": "1.0.0",
  "name": "CDS_Reporting_FHIRv400",
  "title": "CDS Reporting Utilities",
  "status": "active",
  "experimental": true,
  "type" : {
    "coding" : [
      {
        "system" : "http://terminology.hl7.org/CodeSystem/library-type",
        "code" : "logic-library",
        "display" : "Logic Library"
      }
    ]
  },
  "relatedArtifact" : [
    {
      "type" : "depends-on",
      "resource" : "Library/library-commons"
    }
  ],
  "content": [
    {
      "contentType": "text/cql",
      "data": "Ly8gIyBJbnRyb2R1Y3Rpb24KCi8vIFNoYXJlZCBsb2dpYyBsaWJyYXJ5IHRoYXQgc3VwcG9ydHMgQ0RTIHJlcG9ydGluZy4KCmxpYnJhcnkgQ0RTX1JlcG9ydGluZ19GSElSdjQwMCB2ZXJzaW9uICcxLjAuMCcKCi8vICMgRGF0YSBtb2RlbCAjCgp1c2luZyBGSElSIHZlcnNpb24gJzQuMC4xJwoKLy8gIyBSZWZlcmVuY2VkIGxpYnJhcmllcyAjCgovLyBUaGUgQ0RTIENvbm5lY3QgQ29tbW9ucyBmb3IgRkhJUnY0MDAgbGlicmFyeSBwcm92aWRlcyBmdW5jdGlvbnMgcmVwcmVzZW50aW5nIGNvbW1vbmx5IHVzZWQgQ0RTIGxvZ2ljIGFuZCBwYXR0ZXJucy4KaW5jbHVkZSBDRFNfQ29ubmVjdF9Db21tb25zX2Zvcl9GSElSdjQwMCB2ZXJzaW9uICcxLjAuMicgY2FsbGVkIEMzRgovLyBUaGUgRkhJUkhlbHBlcnMgbGlicmFyeSBwcm92aWRlcyBjb21tb24gZnVuY3Rpb25zIGZvciBzaW1wbGlmeWluZyBpbnRlcmFjdGlvbiB3LyB0aGUgRkhJUiBSNCBkYXRhIG1vZGVsLgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJyBjYWxsZWQgRkhJUkhlbHBlcnMKCmNvZGVzeXN0ZW0gIkNvbmRpdGlvbiBDYXRlZ29yeSBDb2RlcyI6ICdodHRwOi8vaGw3Lm9yZy9maGlyL2NvbmRpdGlvbi1jYXRlZ29yeScgLy8gTk9URTogVGhpcyBpcyB0aGUgU1RVMyBjYXRlZ29yeSwgc2hvdWxkIHJlYWxseSBiZSB0aGUgUjQgY2F0ZWdvcnksIGJ1dCBzb21lIHN5c3RlbXMgc3RpbGwgcmV0dXJuIHRoaXMKLy9jb2Rlc3lzdGVtICJDb25kaXRpb24gQ2F0ZWdvcnkgQ29kZXMiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9jb25kaXRpb24tY2F0ZWdvcnknCgpjb2RlICJFbmNvdW50ZXIgRGlhZ25vc2lzIGNvZGUiOiAnZW5jb3VudGVyLWRpYWdub3NpcycgZnJvbSAiQ29uZGl0aW9uIENhdGVnb3J5IENvZGVzIiBkaXNwbGF5ICdFbmNvdW50ZXIgRGlhZ25vc2lzJwoKLy8gIyBDRFMgbG9naWMgIwoKY29udGV4dCBQYXRpZW50CgovLyBUaGUgZm9sbG93aW5nIGNvbmRpdGlvbiBmdW5jdGlvbnMgYXJlIHVzZWQgaGVyZSB0byBhZGRyZXNzIHRoZSBkaWZmZXJlbmNlIGluIGJlaGF2aW9yCi8vIGJldHdlZW4gYSAicHJvYmxlbS1saXN0LWl0ZW0iIGNvbmRpdGlvbiBhbmQgb3RoZXIgY2F0ZWdvcmllcyBvZiBjb25kaXRpb25zLgovLyBTcGVjaWZpY2FsbHksIHByb2JsZW0tbGlzdC1pdGVtcyB0eXBpY2FsbHkgaGF2ZSBjbGluaWNhbFN0YXR1cyBhbmQgdmVyaWZpY2F0aW9uU3RhdHVzCi8vIHdoZXJlIGVuY291bnRlci1kaWFnbm9zZXMgaW4gcGFydGljdWxhciB3b3VsZCBub3QgYmUgZXhwZWN0ZWQgdG8gaGF2ZSB0aG9zZSBpdGVtcwovLyBGb3IgdGhlIFBhaW5NYW5hZ2VyIHVzZSBjYXNlLCBlbmNvdW50ZXItZGlhZ25vc2VzIGNhbiBiZSBpbmNsdWRlZC4KLy8gTk9URTogRW5jb3VudGVyLWRpYWdub3NlcyBzaG91bGQgYmUgZmlsdGVyIGJ5IGEgbG9va2JhY2ssIGJ1dCB0aGF0IGlzIG5vdCBoYW5kbGVkIGJ5IHRoZXNlIGZ1bmN0aW9ucwoKLyoqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgQ29uZGl0aW9uIGhhcyBhIGNhdGVnb3J5IG9mICJlbmNvdW50ZXItZGlhZ25vc2lzIgogKi8KZGVmaW5lIGZ1bmN0aW9uIElzRW5jb3VudGVyRGlhZ25vc2lzKENvbmRpdGlvbiBDb25kaXRpb24pOgogIGV4aXN0cyAoQ29uZGl0aW9uLmNhdGVnb3J5IEMgd2hlcmUgQyB+ICJFbmNvdW50ZXIgRGlhZ25vc2lzIGNvZGUiKQogICAgYW5kIENvbmRpdGlvbi5yZWNvcmRlZERhdGUgYWZ0ZXIgVG9kYXkoKSAtIDEgeWVhcgoKLyoqCiAqIENvbmRpdGlvbnMgdGhhdCBhcmUgY29uZmlybWVkLiBJbiBGSElSIFI0LCB0aGlzIGlzIHJlZmxlY3RlZCBieSB2ZXJpZmljYXRpb25TdGF0dXM6ICdjb25maXJtZWQnLgogKiBAc2VlIGh0dHA6Ly9obDcub3JnL2ZoaXIvUjQvdmFsdWVzZXQtY29uZGl0aW9uLXZlci1zdGF0dXMuaHRtbAogKiBAcGFyYW0gQ29uZExpc3QgLSBhIGxpc3Qgb2YgQ29uZGl0aW9ucwogKiBAcmV0dXJucyB7TGlzdDxDb25kaXRpb24+fSBhIGxpc3Qgb2YgY29uZmlybWVkIENvbmRpdGlvbnMsIG9yIG51bGwgaWYgbnVsbCB3YXMgcGFzc2VkIGluCiAqLwpkZWZpbmUgZnVuY3Rpb24gQ29uZmlybWVkKENvbmRMaXN0IExpc3Q8Q29uZGl0aW9uPik6CiAgQ29uZExpc3QgQyB3aGVyZSBJc0VuY291bnRlckRpYWdub3NpcyhDKSB4b3IgQy52ZXJpZmljYXRpb25TdGF0dXMgfiBDM0YuIkNvbmRpdGlvbiBDb25maXJtZWQgY29kZSIKCi8qKgogKiBDb25kaXRpb25zIHRoYXQgYXJlIGFjdGl2ZS4gSW4gRkhJUiBSNCwgdGhpcyBpcyByZWZsZWN0ZWQgYnkgY2xpbmljYWxTdGF0dXM6ICdhY3RpdmUnIGFuZCB0aGUgYWJzZW5jZSBvZiBhbnkKICogYWJhdGVtZW50IGluZm9ybWF0aW9uIChpLmUuLCBpZiBpdCBhYmF0ZWQsIGl0IGlzIG5vIGxvbmdlciBhY3RpdmUpLgogKiBUT0RPOiBSZW5hbWUgdG8gQWN0aXZlIG9uY2UgdGhlIGV4ZWN1dGlvbiBlbmdpbmUgc3VwcG9ydHMgb3ZlcmxvYWRlZCBmdW5jdGlvbnMuCiAqIEBzZWUgaHR0cDovL2hsNy5vcmcvZmhpci9SNC92YWx1ZXNldC1jb25kaXRpb24tY2xpbmljYWwuaHRtbAogKiBAcGFyYW0gQ29uZExpc3QgLSBhIGxpc3Qgb2YgQ29uZGl0aW9ucwogKiBAcmV0dXJucyB7TGlzdDxDb25kaXRpb24+fSBhIGxpc3Qgb2YgYWN0aXZlIENvbmRpdGlvbnMsIG9yIG51bGwgaWYgbnVsbCB3YXMgcGFzc2VkIGluCiAqLwpkZWZpbmUgZnVuY3Rpb24gQWN0aXZlQ29uZGl0aW9uKENvbmRMaXN0IExpc3Q8Q29uZGl0aW9uPik6CiAgQ29uZExpc3QgQwogICAgd2hlcmUgKElzRW5jb3VudGVyRGlhZ25vc2lzKEMpIHhvciBDLmNsaW5pY2FsU3RhdHVzIH4gQzNGLiJDb25kaXRpb24gQWN0aXZlIGNvZGUiKQogICAgICBhbmQgQy5hYmF0ZW1lbnQgaXMgbnVsbAoKLyoqCiAqIENvbmRpdGlvbnMgdGhhdCBhcmUgYWN0aXZlIG9yIHJlY3VycmluZy4gSW4gRkhJUiBSNCwgdGhpcyBpcyByZWZsZWN0ZWQgYnkgY2xpbmljYWxTdGF0dXM6ICdhY3RpdmUnLCAncmVjdXJyZW5jZScsIG9yCiAqICdyZWxhcHNlJy4gIFdlIGRvIG5vdCBjaGVjayBmb3IgbnVsbCBhYmF0ZW1lbnQgaW5mb3JtYXRpb24gYmVjYXVzZSBpdCBtYXkgaGF2ZSBkYXRlcyBmcm9tIHdoZW4gdGhlIG5vdyByZWN1cnJpbmcKICogY29uZGl0aW9uIGluaXRpYWxseSB3ZW50IGludG8gcmVtaXNzaW9uLgogKiBAc2VlIGh0dHA6Ly9obDcub3JnL2ZoaXIvUjQvdmFsdWVzZXQtY29uZGl0aW9uLWNsaW5pY2FsLmh0bWwKICogQHBhcmFtIENvbmRMaXN0IC0gYSBsaXN0IG9mIENvbmRpdGlvbnMKICogQHJldHVybnMge0xpc3Q8Q29uZGl0aW9uPn0gYSBsaXN0IG9mIGFjdGl2ZSBvciByZWN1cnJpbmcgQ29uZGl0aW9ucywgb3IgbnVsbCBpZiBudWxsIHdhcyBwYXNzZWQgaW4KICovCmRlZmluZSBmdW5jdGlvbiBBY3RpdmVPclJlY3VycmluZyhDb25kTGlzdCBMaXN0PENvbmRpdGlvbj4pOgogIENvbmRMaXN0IEMKICAgIHdoZXJlIElzRW5jb3VudGVyRGlhZ25vc2lzKEMpCiAgICAgIHhvciAoQy5jbGluaWNhbFN0YXR1cyB+IEMzRi4iQ29uZGl0aW9uIEFjdGl2ZSBjb2RlIgogICAgICAgIG9yIEMuY2xpbmljYWxTdGF0dXMgfiBDM0YuIkNvbmRpdGlvbiBSZWN1cnJlbmNlIGNvZGUiCiAgICAgICAgb3IgQy5jbGluaWNhbFN0YXR1cyB+IEMzRi4iQ29uZGl0aW9uIFJlbGFwc2UgY29kZSIpCgovLyAjIyBSZS11c2FibGUgZnVuY3Rpb25zICMjCgovLyBUaGUgc3VtbWFyeSBsb2dpYyBjb250YWlucyBtYW55IGNvbnN0cnVjdHMgdGhhdCBhcmUgbmVlZGVkIHRocm91Z2hvdXQgdGhlIGxvZ2ljLiBXaGVyZSBwb3NzaWJsZSwgdGhlc2UgY29uc3RydWN0cwovLyBoYXZlIGJlZW4gZGV2ZWxvcGVkIGFzIHJlLXVzYWJsZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgaW52b2tlZCB3aGVyZXZlciB0aGV5IGFyZSBuZWVkZWQuCgpkZWZpbmUgZnVuY3Rpb24gQWdlVG9RdWFudGl0eShhZ2UgRkhJUi5BZ2UpOgogIGlmIGFnZSBpcyBudWxsIHRoZW4KICAgIG51bGwgYXMgU3lzdGVtLlF1YW50aXR5CiAgZWxzZQogICAgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShhZ2UpCgpkZWZpbmUgZnVuY3Rpb24gUXVhbnRpdHlUb1F1YW50aXR5KHF1YW50aXR5IEZISVIuUXVhbnRpdHkpOgogIGlmIHF1YW50aXR5IGlzIG51bGwgdGhlbgogICAgbnVsbCBhcyBTeXN0ZW0uUXVhbnRpdHkKICBlbHNlCiAgICBGSElSSGVscGVycy5Ub1F1YW50aXR5KHF1YW50aXR5KQoKLy8gUmV0dXJucyBhIHRleHQgcmVwcmVzZW50YXRpb24gb2YgYSBkYXRlIHVzaW5nIHRoZSBDUUwgYFRvU3RyaW5nYCBmdW5jdGlvbi4KLy8gQHBhcmFtIGQgLSBhIEZISVIgZGF0ZSB0byBnZXQgdGV4dCBmb3IKLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRlCmRlZmluZSBmdW5jdGlvbiBEYXRlVGV4dChkIEZISVIuZGF0ZSk6CiAgVG9TdHJpbmcoZC52YWx1ZSkKCi8vIFJldHVybnMgYSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIGEgZGF0ZVRpbWUgdXNpbmcgdGhlIENRTCBgVG9TdHJpbmdgIGZ1bmN0aW9uLgovLyBAcGFyYW0gZCAtIGEgRkhJUiBkYXRlVGltZSB0byBnZXQgdGV4dCBmb3IKLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRlVGltZQpkZWZpbmUgZnVuY3Rpb24gRGF0ZVRpbWVUZXh0KGQgRkhJUi5kYXRlVGltZSk6CiAgVG9TdHJpbmcoZC52YWx1ZSkKCi8vIFJldHVybnMgYSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbnQgdXNpbmcgdGhlIENRTCBgVG9TdHJpbmdgIGZ1bmN0aW9uLgovLyBAcGFyYW0gaSAtIGEgRkhJUiBpbnN0YW50IHRvIGdldCB0ZXh0IGZvcgovLyBAcmV0dXJucyB7U3lzdGVtLlN0cmluZ30gdGhlIHRleHQgcmVwcmVzZW50YXRpb24gb2YgdGhlIGluc3RhbnQKZGVmaW5lIGZ1bmN0aW9uIEluc3RhbnRUZXh0KGkgRkhJUi5pbnN0YW50KToKICBUb1N0cmluZyhpLnZhbHVlKQoKLy8gUmV0dXJucyBhIHRleHQgcmVwcmVzZW50YXRpb24gb2YgYSBRdWFudGl0eSB3aXRoIHRoZSBRdWFudGl0eSdzIHZhbHVlIGFuZCB1bml0LgovLyBJZiB0aGUgdW5pdCBpcyB7c2NvcmV9LCB0aGVuIG9taXQgaXQgKGFzIGl0IGlzIG5vdCB1c2VmdWwgdG8gZGlzcGxheSkKLy8gQHBhcmFtIHEgLSBhIEZISVIgUXVhbnRpdHkgdG8gZ2V0IHRleHQgZm9yCi8vIEByZXR1cm5zIHtTeXN0ZW0uU3RyaW5nfSB0aGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgUXVhbnRpdHkKZGVmaW5lIGZ1bmN0aW9uIFF1YW50aXR5VGV4dChxIEZISVIuUXVhbnRpdHkpOgogIGlmIChxIGlzIG51bGwpIHRoZW4gbnVsbAogIGVsc2UgaWYgKHEudW5pdCBpcyBub3QgbnVsbCBhbmQgcS51bml0LnZhbHVlICE9ICd7c2NvcmV9JykgdGhlbiBUb1N0cmluZyhxLnZhbHVlLnZhbHVlKSArICcgJyArIHEudW5pdC52YWx1ZQogIGVsc2UgaWYgKHEuY29kZSBpcyBub3QgbnVsbCBhbmQgcS5jb2RlLnZhbHVlICE9ICd7c2NvcmV9JykgdGhlbiBUb1N0cmluZyhxLnZhbHVlLnZhbHVlKSArICcgJyArIHEuY29kZS52YWx1ZQogIGVsc2UgVG9TdHJpbmcocS52YWx1ZS52YWx1ZSkKCi8vIFJldHVybnMgYSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIGFuIE1NRSBRdWFudGl0eSB3aXRoIHRoZSBRdWFudGl0eSdzIHZhbHVlIGFuZCB1bml0IGluIGFzIGEgdXNlci1mcmllbmRseSBkaXNwbGF5LgovLyBJZiB0aGUgdW5pdCBpcyB7TU1FfS9kLCBkaXNwbGF5IGl0IGFzIE1NRS9EYXksIG90aGVyd2lzZSwganVzdCByZXR1cm4gdGhlIFRvU3RyaW5nIG9mIHRoZSBnaXZlbiBxdWFudGl0eS4KLy8gQHBhcmFtIHF1YW50aXR5IC0gTU1FIGFzIGEgU3lzdGVtIFF1YW50aXR5IHRvIGdldCB0ZXh0IGZvcgovLyBAcmV0dXJucyB7U3lzdGVtLlN0cmluZ30gYSB1c2VyLWZyaWVuZGx5IHRleHQgcmVwcmVzZW50YXRpb24gb2YgdGhlIE1NRQpkZWZpbmUgZnVuY3Rpb24gTU1FVGV4dChxdWFudGl0eSBTeXN0ZW0uUXVhbnRpdHkpOgogIGlmIHF1YW50aXR5LnVuaXQgPSAne01NRX0vZCcgdGhlbgogICAgVG9TdHJpbmcocXVhbnRpdHkudmFsdWUpICsgJyBNTUUvRGF5JwogIGVsc2UKICAgIFRvU3RyaW5nKHF1YW50aXR5KQoKLy8gUmV0dXJucyBhIHR1cGxlIGNvbnRhaW5pbmcgYSBQZXJpb2QncyBzdGFydCBhbmQgZW5kIGFzIHRleHQgcmVwcmVzZW50YXRpb25zLgovLyBAcGFyYW0gcCAtIGEgRkhJUiBQZXJpb2QgdG8gZ2V0IGEgdHVwbGUgZm9yCi8vIEByZXR1cm5zIHtUdXBsZTxTdGFydCBTeXN0ZW0uU3RyaW5nLCBFbmQgU3lzdGVtLlN0cmluZz59IHRoZSB0dXBsZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgUGVyaW9kCmRlZmluZSBmdW5jdGlvbiBQZXJpb2RPYmplY3QocCBGSElSLlBlcmlvZCk6CiAgaWYgcCBpcyBudWxsIHRoZW4gbnVsbAogIGVsc2UKICAgIHsKICAgICAgU3RhcnQ6IERhdGVUaW1lVGV4dChwLiJzdGFydCIpLAogICAgICBFbmQ6IERhdGVUaW1lVGV4dChwLiJlbmQiKQogICAgfQoKLy8gUmV0dXJucyBhIHR1cGxlIGNvbnRhaW5pbmcgYSBSYW5nZSdzIGxvdyBhbmQgaGlnaCBhcyB0ZXh0IHJlcHJlc2VudGF0aW9ucy4KLy8gQHBhcmFtIHIgLSBhIEZISVIgUmFuZ2UgdG8gZ2V0IGEgdHVwbGUgZm9yCi8vIEByZXR1cm5zIHtUdXBsZTxMb3cgU3lzdGVtLlN0cmluZywgSGlnaCBTeXN0ZW0uU3RyaW5nPn0gdGhlIHR1cGxlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBSYW5nZQpkZWZpbmUgZnVuY3Rpb24gUmFuZ2VPYmplY3QociBGSElSLlJhbmdlKToKICBpZiByIGlzIG51bGwgdGhlbiBudWxsCiAgZWxzZQogICAgewogICAgICBMb3c6IFF1YW50aXR5VGV4dChyLmxvdyksCiAgICAgIEhpZ2g6IFF1YW50aXR5VGV4dChyLmhpZ2gpCiAgICB9CgovLyBSZXR1cm5zIGEgdGV4dCByZXByZXNlbnRhdGlvbiBvZiBhIGRhdGUgYXNzb2NpYXRlZCB3aXRoIGFuIE9ic2VydmF0aW9uLCBwcmVmZXJyaW5nIGBlZmZlY3RpdmVEYXRlVGltZWAsIHRoZW4KLy8gYGVmZmVjdGl2ZVBlcmlvZC5zdGFydGAsIHRoZW4gYGlzc3VlZGAuCi8vIEBwYXJhbSBvIC0gYSBGSElSIE9ic2VydmF0aW9uIHRvIGdldCB0aGUgdGV4dCBkYXRlIGZyb20KLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIGEgcmVsZXZhbnQgZGF0ZSBmcm9tIHRoZSBPYnNlcnZhdGlvbgpkZWZpbmUgZnVuY3Rpb24gT2JzZXJ2YXRpb25EYXRlKG8gRkhJUi5PYnNlcnZhdGlvbik6CiAgQ29hbGVzY2UoCiAgICBEYXRlVGltZVRleHQoby5lZmZlY3RpdmUgYXMgRkhJUi5kYXRlVGltZSksCiAgICBJbnN0YW50VGV4dChvLmVmZmVjdGl2ZSBhcyBGSElSLmluc3RhbnQpLAogICAgRGF0ZVRpbWVUZXh0KChvLmVmZmVjdGl2ZSBhcyBGSElSLlBlcmlvZCkuInN0YXJ0IiksCiAgICBJbnN0YW50VGV4dChvLmlzc3VlZCkKICApCgovLyBSZXR1cm5zIGEgdGV4dCByZXByZXNlbnRhdGlvbiBvZiBhIGRhdGUgYXNzb2NpYXRlZCB3aXRoIGEgTWVkaWNhdGlvblN0YXRlbWVudCwgcHJlZmVycmluZyBgZWZmZWN0aXZlRGF0ZVRpbWVgLCB0aGVuCi8vIGAuc3RhcnRgLgovLyBAcGFyYW0gcyAtIGEgRkhJUiBNZWRpY2F0aW9uU3RhdGVtZW50IHRvIGdldCB0aGUgdGV4dCBkYXRlIGZyb20KLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIGEgcmVsZXZhbnQgZGF0ZSBmcm9tIHRoZSBNZWRpY2F0aW9uU3RhdGVtZW50CmRlZmluZSBmdW5jdGlvbiBNZWRpY2F0aW9uU3RhdGVtZW50RGF0ZShzIEZISVIuTWVkaWNhdGlvblN0YXRlbWVudCk6CiAgQ29hbGVzY2UoCiAgICBEYXRlVGltZVRleHQocy5lZmZlY3RpdmUgYXMgRkhJUi5kYXRlVGltZSksCiAgICBEYXRlVGltZVRleHQoKHMuZWZmZWN0aXZlIGFzIEZISVIuUGVyaW9kKS4ic3RhcnQiKSwKICAgIERhdGVUaW1lVGV4dChzLmRhdGVBc3NlcnRlZCkKICApCgovLyBSZXR1cm5zIGEgdGV4dCByZXByZXNlbnRhdGlvbiBvZiBhIENvbmRpdGlvbidzIG9uc2V0LCB3aGV0aGVyIHJlcHJlc2VudGVkIGFzIGEgZGF0ZVRpbWUsIFBlcmlvZCwgUXVhbnRpdHkgKEFnZSksCi8vIFJhbmdlIChBZ2UpLCBvciBzdHJpbmcuCi8vIEBwYXJhbSBjIC0gYSBGSElSIENvbmRpdGlvbiB0byBnZXQgdGhlIHRleHQgcmVwcmVzZW50YXRpb24gb2YgdGhlIG9uc2V0IGZyb20KLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBDb25kaXRpb24ncyBvbnNldApkZWZpbmUgZnVuY3Rpb24gT25zZXQoYyBGSElSLkNvbmRpdGlvbik6CiAgQ29hbGVzY2UoewogICAgRGF0ZVRpbWVUZXh0KGMub25zZXQgYXMgRkhJUi5kYXRlVGltZSksCiAgICBRdWFudGl0eVRleHQoYy5vbnNldCBhcyBGSElSLkFnZSksCiAgICBQZXJpb2RPYmplY3QoYy5vbnNldCBhcyBGSElSLlBlcmlvZCksCiAgICBSYW5nZU9iamVjdChjLm9uc2V0IGFzIEZISVIuUmFuZ2UpLAogICAgKGMub25zZXQgYXMgRkhJUi5zdHJpbmcpLnZhbHVlCiAgfSkKCi8vIFJldHVybnMgdGhlIGRhdGUgb2YgYSBDb25kaXRpb24ncyBvbnNldCwgd2hldGhlciByZXByZXNlbnRlZCBhcyBhIGRhdGVUaW1lLCBQZXJpb2QsIFF1YW50aXR5IChBZ2UpLAovLyBSYW5nZSAoQWdlKSwgb3IgdGhlIHJlY29yZGVkRGF0ZSBpZiBubyBvbnNldCBpcyBhdmFpbGFibGUKLy8gQHBhcmFtIGMgLSBhIEZISVIgQ29uZGl0aW9uIHRvIGdldCB0aGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb25zZXQgZnJvbQovLyBAcmV0dXJucyB7U3lzdGVtLkRhdGVUaW1lfSB0aGUgZGF0ZSBvZiB0aGUgQ29uZGl0aW9uJ3Mgb25zZXQgb3Igd2hlbiBpdCB3YXMgcmVjb3JkZWQKZGVmaW5lIGZ1bmN0aW9uIE9uc2V0T3JSZWNvcmRlZERhdGUoYyBGSElSLkNvbmRpdGlvbik6CiAgQ29hbGVzY2UoCiAgICAoYy5vbnNldCBhcyBGSElSLmRhdGVUaW1lKS52YWx1ZSwKICAgIC8vUGF0aWVudC5iaXJ0aERhdGUgKyBBZ2VUb1F1YW50aXR5KGMub25zZXQpLAogICAgKGMub25zZXQgYXMgRkhJUi5QZXJpb2QpLiJzdGFydCIudmFsdWUsCiAgICAvL1BhdGllbnQuYmlydGhEYXRlICsgUXVhbnRpdHlUb1F1YW50aXR5KChjLm9uc2V0IGFzIEZISVIuUmFuZ2UpLiJsb3ciKSwKICAgIGMucmVjb3JkZWREYXRlLnZhbHVlCiAgKQoKLy8gUmV0dXJucyBhIHRleHQgcmVwcmVzZW50YXRpb24gb2YgYSBDb25kaXRpb24ncyBhYmF0ZW1lbnQsIHdoZXRoZXIgcmVwcmVzZW50ZWQgYXMgYSBkYXRlVGltZSwgUGVyaW9kLCBRdWFudGl0eSAoQWdlKSwKLy8gUmFuZ2UgKEFnZSksIHN0cmluZywgb3IgYm9vbGVhbi4KLy8gQHBhcmFtIGMgLSBhIEZISVIgQ29uZGl0aW9uIHRvIGdldCB0aGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWJhdGVtZW50IGZyb20KLy8gQHJldHVybnMge1N5c3RlbS5TdHJpbmd9IHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBDb25kaXRpb24ncyBhYmF0ZW1lbnQKZGVmaW5lIGZ1bmN0aW9uIEFiYXRlbWVudChjIEZISVIuQ29uZGl0aW9uKToKICBDb2FsZXNjZSh7CiAgICBEYXRlVGltZVRleHQoYy5hYmF0ZW1lbnQgYXMgRkhJUi5kYXRlVGltZSksCiAgICBRdWFudGl0eVRleHQoYy5hYmF0ZW1lbnQgYXMgRkhJUi5BZ2UpLAogICAgUGVyaW9kT2JqZWN0KGMuYWJhdGVtZW50IGFzIEZISVIuUGVyaW9kKSwKICAgIFJhbmdlT2JqZWN0KGMuYWJhdGVtZW50IGFzIEZISVIuUmFuZ2UpLAogICAgKGMuYWJhdGVtZW50IGFzIEZISVIuc3RyaW5nKS52YWx1ZQogIH0pCg=="
    }
  ]
}
